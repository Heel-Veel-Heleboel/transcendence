// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}


model User {
  id                    Int     @id @default(autoincrement())

  email                 String  @unique
  user_name             String?
  profile               Profile?
  activity_status       ActivityStatus @default(OFFLINE)

  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt

  sent_friendships      Friendship[] @relation("sent_friendships")
  received_friendships  Friendship[] @relation("received_friendships")

  matches_as_player1    Match[] @relation("Player_1_Matches")
  matches_as_player2    Match[] @relation("Player_2_Matches")
  matches_won           Match[] @relation("MatchWinner")

}

model Profile {
  id                    Int @id @default(autoincrement())

  bio                   String
  wins                  Int @default(0)
  losses                Int @default(0)
  avatar_url            String?
  win_rate              Float @default(0.0)
  user                  User @relation(fields: [user_id], references: [id])
  user_id               Int @unique

  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
}

model Friendship {
  id                     Int  @id @default(autoincrement())
  requester              User @relation("sent_friendships", fields: [requester_id], references: [id])
  requester_id           Int
  addressee              User @relation("received_friendships", fields: [addressee_id], references: [id])
  addressee_id           Int
  status                 FriendshipStatus
  created_at             DateTime @default(now())
  updated_at             DateTime @updatedAt
  @@unique([requester_id, addressee_id])
}

model Match {
  id Int @id @default(autoincrement())
  player1 User @relation("Player_1_Matches", fields: [player1_id], references: [id])
  player1_id Int 
  player2 User @relation("Player_2_Matches", fields: [player2_id], references: [id])
  player2_id Int
  winner User? @relation("MatchWinner", fields: [winner_id], references: [id])
  winner_id Int?
  played_at DateTime @default(now())
  score1  Int
  score2  Int

}

enum FriendshipStatus {
  PENDING
  ACCEPTED
  REJECTED
  BLOCKED
}

enum ActivityStatus {
  ONLINE
  OFFLINE
  AWAY
  BUSY
}