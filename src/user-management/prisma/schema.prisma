// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}


model User {
  id                    Int     @id @default(autoincrement())

  name                  String @unique
  profile               Profile?
  email                 String  @unique
  activity_status       ActivityStatus @default(OFFLINE)

  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt

  sent_friendships      Friendship[] @relation("sent_friendships")
  received_friendships  Friendship[] @relation("received_friendships")
}

model Profile {
  id                    Int @id @default(autoincrement())

  wins                  Int @default(0)
  losses                Int @default(0)
  avatar_url            String?
  win_rate              Float @default(0.0)

  user                  User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id               Int @unique

  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
}

model Friendship {
  id                     Int  @id @default(autoincrement())

  requester              User @relation("sent_friendships", fields: [requester_id], references: [id], onDelete: Cascade)
  requester_id           Int

  addressee              User @relation("received_friendships", fields: [addressee_id], references: [id], onDelete: Cascade)
  addressee_id           Int

  status                 FriendshipStatus

  created_at             DateTime @default(now())
  updated_at             DateTime @updatedAt

  @@unique([requester_id, addressee_id])
}

enum FriendshipStatus {
  PENDING
  ACCEPTED
  REJECTED
  BLOCKED
}

enum ActivityStatus {
  ONLINE
  OFFLINE
}